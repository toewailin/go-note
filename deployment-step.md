### Deployment Steps Overview

1. **Build the Go Binary**: Compile your Go project into a binary.
2. **Organize Your Files on the Server**: Place your binary, configuration files, and any other assets in the appropriate directories.
3. **Set Up Environment Variables**: Configure environment variables (e.g., database credentials, JWT secrets) on the server.
4. **Set Permissions and Security**: Ensure proper permissions for sensitive files like **PEM** files and environment files.
5. **Run as a Service (Optional)**: Set up the application to run as a system service (e.g., using **systemd**).

### 1. **Building the Go Binary**

First, you need to compile your Go project into a binary suitable for the Linux server. In your project’s root directory, run:

```bash
GOOS=linux GOARCH=amd64 go build -o myapp
```

This will generate the **`myapp`** binary file for Linux (64-bit architecture).

### 2. **Organizing Files on the Server**

#### 2.1 **Binary Files**

* The **Go binary** (`myapp`) should be placed in a system-wide executable directory, such as `/usr/local/bin` or `/opt/myapp`.

  **Recommended directory structure**:

  ```plaintext
  /opt/myapp/
  ├── myapp                 # The Go binary file
  ├── config/               # Configuration files (e.g., .env, other settings)
  ├── certs/                # PEM files for certificates/keys
  └── logs/                  # Log files generated by your app
  ```

#### 2.2 **Configuration Files (e.g., `.env`)**

* Configuration files (e.g., **`.env`**, **`config.json`**) should be placed in a **secure directory**, ideally outside of the web server’s document root or application code.

  **Recommended location**:

  ```plaintext
  /opt/myapp/config/.env
  ```

  **Permissions**: Make sure to restrict access to these configuration files.

  Example commands to set permissions:

  ```bash
  sudo chown -R myuser:mygroup /opt/myapp
  sudo chmod -R 700 /opt/myapp/config
  ```

  If you use **`systemd`** or another service manager, you may also configure environment variables directly within the service configuration.

#### 2.3 **PEM Files (e.g., Keys, Certificates)**

* **PEM files** (private keys, certificates) should be stored in a **secure directory**, and their permissions should be **restricted** to only the application or user running the service.

  **Recommended directory**:

  ```plaintext
  /opt/myapp/certs/
  ├── server.key           # Private key (should be securely stored)
  └── server.pem           # Public certificate
  ```

  **Permissions**:

  ```bash
  sudo chown -R myuser:mygroup /opt/myapp/certs
  sudo chmod 600 /opt/myapp/certs/*
  ```

#### 2.4 **Log Files**

* Log files generated by the application should be stored in a **logs** directory, separate from the application code, to keep everything organized and to facilitate log rotation.

  **Recommended directory**:

  ```plaintext
  /opt/myapp/logs/
  ```

  **Permissions**:

  ```bash
  sudo chown -R myuser:mygroup /opt/myapp/logs
  sudo chmod 755 /opt/myapp/logs
  ```

### 3. **Set Up Environment Variables**

You can set environment variables in a few different ways, depending on your setup:

#### 3.1 **Using `.env` File**

If you're using a `.env` file to store environment variables, you can load it with tools like **`godotenv`** (in development) or use the **`export`** command in your shell on the server.

For **production**, it’s better to set these variables in the **service manager** (e.g., **`systemd`**) or use **`export`** in the shell profile.

* If using **`godotenv`** in your Go application, ensure that your `.env` file is placed securely in the `/opt/myapp/config/` directory.

#### 3.2 **Using Systemd or Service Manager**

If you are running your Go application as a service (which is common for production deployments), you can set environment variables within the **`systemd`** configuration file or **service** script.

* Create a **`systemd`** service for your application:

  ```bash
  sudo nano /etc/systemd/system/myapp.service
  ```

* Example **`myapp.service`** configuration:

  ```ini
  [Unit]
  Description=My Go Application

  [Service]
  ExecStart=/opt/myapp/myapp
  WorkingDirectory=/opt/myapp
  EnvironmentFile=/opt/myapp/config/.env
  User=myuser
  Group=mygroup
  Restart=always
  RestartSec=10
  LimitNOFILE=4096

  [Install]
  WantedBy=multi-user.target
  ```

* This will load the environment variables from **`/opt/myapp/config/.env`** when starting the service.

* After creating the service file, reload **systemd** and start the service:

  ```bash
  sudo systemctl daemon-reload
  sudo systemctl enable myapp.service
  sudo systemctl start myapp.service
  ```

#### 3.3 **Exporting Variables Directly**

For **temporary sessions** or **manual environments**, you can set environment variables directly in the shell or in a **startup script**.

```bash
export DB_HOST=localhost
export DB_PORT=5432
export JWT_SECRET=mysecretkey
```

### 4. **Start the Go Application**

Once everything is in place, you can run your Go binary either manually or as a service. Here's how to run it manually or using **`systemd`**.

#### 4.1 **Running Manually**

```bash
cd /opt/myapp
./myapp
```

#### 4.2 **Running with Systemd (recommended for production)**

As mentioned earlier, you can run the Go application as a **systemd service** to ensure it starts on boot and restarts automatically if it crashes.

```bash
sudo systemctl start myapp.service
```

To check the status:

```bash
sudo systemctl status myapp.service
```

### Summary of Best Practices:

* **Binary File**: Place it under **`/opt/myapp/`** (or `/usr/local/bin/` if you want it to be globally accessible).
* **Configuration Files**: Place **`.env`** and other configuration files under **`/opt/myapp/config/`**. Keep them secure and restrict access.
* **PEM Files**: Place sensitive **PEM files** under **`/opt/myapp/certs/`** with restricted permissions (`chmod 600`).
* **Logs**: Place logs in **`/opt/myapp/logs/`** to easily manage and rotate them.
* **Service Management**: Use **`systemd`** (or another service manager) for running your Go application as a background service.

By following these steps and placing your files in the recommended directories, your Go project will be organized, secure, and ready for production deployment.
